import{g as Ye,c as pe,a as Ke,j as u,b as Oe,p as Ue,u as Pe,r as L,d as ze}from"./index-a193a50d.js";import{u as W}from"./index-583609be.js";var Ge={exports:{}};const et={},tt=Object.freeze(Object.defineProperty({__proto__:null,default:et},Symbol.toStringTag,{value:"Module"})),ue=Ye(tt);var De={exports:{}};const st=/^\u0001ACTION ([^\u0001]+)\u0001$/,ot=/^(justinfan)(\d+$)/,nt=/\\([sn:r\\])/g,it=/([ \n;\r\\])/g,ge={s:" ",n:"",":":";",r:""},be={" ":"s","\n":"n",";":":","\r":"r"},rt=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),at=/[|\\^$*+?:#]/,re=De.exports={get:(e,t)=>typeof e>"u"?t:e,hasOwn:(e,t)=>({}).hasOwnProperty.call(e,t),promiseDelay:e=>new Promise(t=>setTimeout(t,e)),isFinite:e=>isFinite(e)&&!isNaN(parseFloat(e)),toNumber(e,t){if(e===null)return 0;const s=Math.pow(10,re.isFinite(t)?t:0);return Math.round(e*s)/s},isInteger:e=>!isNaN(re.toNumber(e,0)),isRegex:e=>at.test(e),isURL:e=>rt.test(e),justinfan:()=>`justinfan${Math.floor(Math.random()*8e4+1e3)}`,isJustinfan:e=>ot.test(e),channel(e){const t=(e||"").toLowerCase();return t[0]==="#"?t:"#"+t},username(e){const t=(e||"").toLowerCase();return t[0]==="#"?t.slice(1):t},token:e=>e?e.toLowerCase().replace("oauth:",""):"",password(e){const t=re.token(e);return t?`oauth:${t}`:""},actionMessage:e=>e.match(st),replaceAll(e,t){if(e===null||typeof e>"u")return null;for(const s in t)e=e.replace(new RegExp(s,"g"),t[s]);return e},unescapeHtml:e=>e.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'"),unescapeIRC(e){return!e||typeof e!="string"||!e.includes("\\")?e:e.replace(nt,(t,s)=>s in ge?ge[s]:s)},escapeIRC(e){return!e||typeof e!="string"?e:e.replace(it,(t,s)=>s in be?`\\${be[s]}`:s)},addWord:(e,t)=>e.length?e+" "+t:e+t,splitLine(e,t){let s=e.substring(0,t).lastIndexOf(" ");return s===-1&&(s=t-1),[e.substring(0,s),e.substring(s+1)]},extractNumber(e){const t=e.split(" ");for(let s=0;s<t.length;s++)if(re.isInteger(t[s]))return~~t[s];return 0},formatDate(e){let t=e.getHours(),s=e.getMinutes();return t=(t<10?"0":"")+t,s=(s<10?"0":"")+s,`${t}:${s}`},inherits(e,t){e.super_=t;const s=function(){};s.prototype=t.prototype,e.prototype=new s,e.prototype.constructor=e},isNode(){try{return typeof process=="object"&&Object.prototype.toString.call(process)==="[object process]"}catch{}return!1}};var ne=De.exports;const lt=ue,_e=ne;var ct=function(t,s){let o=t.url!==void 0?t.url:t.uri;if(_e.isURL(o)||(o=`https://api.twitch.tv/kraken${o[0]==="/"?o:`/${o}`}`),_e.isNode()){const i=Object.assign({method:"GET",json:!0},t);if(i.qs){const g=new URLSearchParams(i.qs);o+=`?${g}`}const a={};"fetchAgent"in this.opts.connection&&(a.agent=this.opts.connection.fetchAgent);const d=lt(o,{...a,method:i.method,headers:i.headers,body:i.body});let f={};d.then(g=>(f={statusCode:g.status,headers:g.headers},i.json?g.json():g.text())).then(g=>s(null,f,g),g=>s(g,f,null))}else{const i=Object.assign({method:"GET",headers:{}},t,{url:o}),a=new XMLHttpRequest;a.open(i.method,i.url,!0);for(const d in i.headers)a.setRequestHeader(d,i.headers[d]);a.responseType="json",a.addEventListener("load",d=>{a.readyState===4&&(a.status!==200?s(a.status,null,null):s(null,null,a.response))}),a.send()}};const v=ne;function ve(e,t){return e=v.channel(e),t=v.get(t,30),this._sendCommand(null,e,`/followers ${t}`,(s,o)=>{this.once("_promiseFollowers",i=>{i?o(i):s([e,~~t])})})}function xe(e){return e=v.channel(e),this._sendCommand(null,e,"/followersoff",(t,s)=>{this.once("_promiseFollowersoff",o=>{o?s(o):t([e])})})}function we(e){return e=v.channel(e),this._sendCommand(null,null,`PART ${e}`,(t,s)=>{this.once("_promisePart",o=>{o?s(o):t([e])})})}function ye(e){return e=v.channel(e),this._sendCommand(null,e,"/r9kbeta",(t,s)=>{this.once("_promiseR9kbeta",o=>{o?s(o):t([e])})})}function Ce(e){return e=v.channel(e),this._sendCommand(null,e,"/r9kbetaoff",(t,s)=>{this.once("_promiseR9kbetaoff",o=>{o?s(o):t([e])})})}function ke(e,t){return e=v.channel(e),t=v.get(t,300),this._sendCommand(null,e,`/slow ${t}`,(s,o)=>{this.once("_promiseSlow",i=>{i?o(i):s([e,~~t])})})}function Te(e){return e=v.channel(e),this._sendCommand(null,e,"/slowoff",(t,s)=>{this.once("_promiseSlowoff",o=>{o?s(o):t([e])})})}var ut={action(e,t){return e=v.channel(e),t=`ACTION ${t}`,this._sendMessage(this._getPromiseDelay(),e,t,(s,o)=>{s([e,t])})},ban(e,t,s){return e=v.channel(e),t=v.username(t),s=v.get(s,""),this._sendCommand(null,e,`/ban ${t} ${s}`,(o,i)=>{this.once("_promiseBan",a=>{a?i(a):o([e,t,s])})})},clear(e){return e=v.channel(e),this._sendCommand(null,e,"/clear",(t,s)=>{this.once("_promiseClear",o=>{o?s(o):t([e])})})},color(e,t){return t=v.get(t,e),this._sendCommand(null,"#tmijs",`/color ${t}`,(s,o)=>{this.once("_promiseColor",i=>{i?o(i):s([t])})})},commercial(e,t){return e=v.channel(e),t=v.get(t,30),this._sendCommand(null,e,`/commercial ${t}`,(s,o)=>{this.once("_promiseCommercial",i=>{i?o(i):s([e,~~t])})})},deletemessage(e,t){return e=v.channel(e),this._sendCommand(null,e,`/delete ${t}`,(s,o)=>{this.once("_promiseDeletemessage",i=>{i?o(i):s([e])})})},emoteonly(e){return e=v.channel(e),this._sendCommand(null,e,"/emoteonly",(t,s)=>{this.once("_promiseEmoteonly",o=>{o?s(o):t([e])})})},emoteonlyoff(e){return e=v.channel(e),this._sendCommand(null,e,"/emoteonlyoff",(t,s)=>{this.once("_promiseEmoteonlyoff",o=>{o?s(o):t([e])})})},followersonly:ve,followersmode:ve,followersonlyoff:xe,followersmodeoff:xe,host(e,t){return e=v.channel(e),t=v.username(t),this._sendCommand(2e3,e,`/host ${t}`,(s,o)=>{this.once("_promiseHost",(i,a)=>{i?o(i):s([e,t,~~a])})})},join(e){return e=v.channel(e),this._sendCommand(void 0,null,`JOIN ${e}`,(t,s)=>{const o="_promiseJoin";let i=!1;const a=(f,g)=>{e===v.channel(g)&&(this.removeListener(o,a),i=!0,f?s(f):t([e]))};this.on(o,a);const d=this._getPromiseDelay();v.promiseDelay(d).then(()=>{i||this.emit(o,"No response from Twitch.",e)})})},mod(e,t){return e=v.channel(e),t=v.username(t),this._sendCommand(null,e,`/mod ${t}`,(s,o)=>{this.once("_promiseMod",i=>{i?o(i):s([e,t])})})},mods(e){return e=v.channel(e),this._sendCommand(null,e,"/mods",(t,s)=>{this.once("_promiseMods",(o,i)=>{o?s(o):(i.forEach(a=>{this.moderators[e]||(this.moderators[e]=[]),this.moderators[e].includes(a)||this.moderators[e].push(a)}),t(i))})})},part:we,leave:we,ping(){return this._sendCommand(null,null,"PING",(e,t)=>{this.latency=new Date,this.pingTimeout=setTimeout(()=>{this.ws!==null&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout))},v.get(this.opts.connection.timeout,9999)),this.once("_promisePing",s=>e([parseFloat(s)]))})},r9kbeta:ye,r9kmode:ye,r9kbetaoff:Ce,r9kmodeoff:Ce,raw(e){return this._sendCommand(null,null,e,(t,s)=>{t([e])})},say(e,t){return e=v.channel(e),t.startsWith(".")&&!t.startsWith("..")||t.startsWith("/")||t.startsWith("\\")?t.substr(1,3)==="me "?this.action(e,t.substr(4)):this._sendCommand(null,e,t,(s,o)=>{s([e,t])}):this._sendMessage(this._getPromiseDelay(),e,t,(s,o)=>{s([e,t])})},slow:ke,slowmode:ke,slowoff:Te,slowmodeoff:Te,subscribers(e){return e=v.channel(e),this._sendCommand(null,e,"/subscribers",(t,s)=>{this.once("_promiseSubscribers",o=>{o?s(o):t([e])})})},subscribersoff(e){return e=v.channel(e),this._sendCommand(null,e,"/subscribersoff",(t,s)=>{this.once("_promiseSubscribersoff",o=>{o?s(o):t([e])})})},timeout(e,t,s,o){return e=v.channel(e),t=v.username(t),s!==null&&!v.isInteger(s)&&(o=s,s=300),s=v.get(s,300),o=v.get(o,""),this._sendCommand(null,e,`/timeout ${t} ${s} ${o}`,(i,a)=>{this.once("_promiseTimeout",d=>{d?a(d):i([e,t,~~s,o])})})},unban(e,t){return e=v.channel(e),t=v.username(t),this._sendCommand(null,e,`/unban ${t}`,(s,o)=>{this.once("_promiseUnban",i=>{i?o(i):s([e,t])})})},unhost(e){return e=v.channel(e),this._sendCommand(2e3,e,"/unhost",(t,s)=>{this.once("_promiseUnhost",o=>{o?s(o):t([e])})})},unmod(e,t){return e=v.channel(e),t=v.username(t),this._sendCommand(null,e,`/unmod ${t}`,(s,o)=>{this.once("_promiseUnmod",i=>{i?o(i):s([e,t])})})},unvip(e,t){return e=v.channel(e),t=v.username(t),this._sendCommand(null,e,`/unvip ${t}`,(s,o)=>{this.once("_promiseUnvip",i=>{i?o(i):s([e,t])})})},vip(e,t){return e=v.channel(e),t=v.username(t),this._sendCommand(null,e,`/vip ${t}`,(s,o)=>{this.once("_promiseVip",i=>{i?o(i):s([e,t])})})},vips(e){return e=v.channel(e),this._sendCommand(null,e,"/vips",(t,s)=>{this.once("_promiseVips",(o,i)=>{o?s(o):t(i)})})},whisper(e,t){return e=v.username(e),e===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(null,"#tmijs",`/w ${e} ${t}`,(s,o)=>{this.once("_promiseWhisper",i=>{i&&o(i)})}).catch(s=>{if(s&&typeof s=="string"&&s.indexOf("No response from Twitch.")!==0)throw s;const o=v.channel(e),i=Object.assign({"message-type":"whisper","message-id":null,"thread-id":null,username:this.getUsername()},this.globaluserstate);return this.emits(["whisper","message"],[[o,i,t,!0],[o,i,t,!0]]),[e,t]})}};function U(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var dt=U;U.EventEmitter=U;U.prototype._events=void 0;U.prototype._maxListeners=void 0;U.defaultMaxListeners=10;U.prototype.setMaxListeners=function(e){if(!mt(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this};U.prototype.emit=function(e){var t,s,o,i,a,d;if(this._events||(this._events={}),e==="error"&&(!this._events.error||oe(this._events.error)&&!this._events.error.length))throw t=arguments[1],t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');if(s=this._events[e],Be(s))return!1;if(H(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),s.apply(this,i)}else if(oe(s))for(i=Array.prototype.slice.call(arguments,1),d=s.slice(),o=d.length,a=0;a<o;a++)d[a].apply(this,i);return!0};U.prototype.addListener=function(e,t){var s;if(!H(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,H(t.listener)?t.listener:t),this._events[e]?oe(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,oe(this._events[e])&&!this._events[e].warned&&(Be(this._maxListeners)?s=U.defaultMaxListeners:s=this._maxListeners,s&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),typeof console.trace=="function"&&console.trace())),this};U.prototype.on=U.prototype.addListener;U.prototype.once=function(e,t){if(!H(t))throw TypeError("listener must be a function");var s=!1;if(this._events.hasOwnProperty(e)&&e.charAt(0)==="_"){var o=1,i=e;for(var a in this._events)this._events.hasOwnProperty(a)&&a.startsWith(i)&&o++;e=e+o}function d(){e.charAt(0)==="_"&&!isNaN(e.substr(e.length-1))&&(e=e.substring(0,e.length-1)),this.removeListener(e,d),s||(s=!0,t.apply(this,arguments))}return d.listener=t,this.on(e,d),this};U.prototype.removeListener=function(e,t){var s,o,i,a;if(!H(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=this._events[e],i=s.length,o=-1,s===t||H(s.listener)&&s.listener===t){if(delete this._events[e],this._events.hasOwnProperty(e+"2")&&e.charAt(0)==="_"){var d=e;for(var f in this._events)this._events.hasOwnProperty(f)&&f.startsWith(d)&&(isNaN(parseInt(f.substr(f.length-1)))||(this._events[e+parseInt(f.substr(f.length-1)-1)]=this._events[f],delete this._events[f]));this._events[e]=this._events[e+"1"],delete this._events[e+"1"]}this._events.removeListener&&this.emit("removeListener",e,t)}else if(oe(s)){for(a=i;a-- >0;)if(s[a]===t||s[a].listener&&s[a].listener===t){o=a;break}if(o<0)return this;s.length===1?(s.length=0,delete this._events[e]):s.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this};U.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[e]&&delete this._events[e],this;if(arguments.length===0){for(t in this._events)t!=="removeListener"&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[e],H(s))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this};U.prototype.listeners=function(e){var t;return!this._events||!this._events[e]?t=[]:H(this._events[e])?t=[this._events[e]]:t=this._events[e].slice(),t};U.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(H(t))return 1;if(t)return t.length}return 0};U.listenerCount=function(e,t){return e.listenerCount(t)};function H(e){return typeof e=="function"}function mt(e){return typeof e=="number"}function oe(e){return typeof e=="object"&&e!==null}function Be(e){return e===void 0}const ht=ne;let Fe="info";const Se={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};function K(e){return function(t){Se[e]>=Se[Fe]&&console.log(`[${ht.formatDate(new Date)}] ${e}: ${t}`)}}var ft={setLevel(e){Fe=e},trace:K("trace"),debug:K("debug"),info:K("info"),warn:K("warn"),error:K("error"),fatal:K("fatal")};const le=ne,ee=/\S+/g;function ce(e,t,s=",",o="/",i){const a=e[t];if(a===void 0)return e;const d=typeof a=="string";if(e[t+"-raw"]=d?a:null,a===!0)return e[t]=null,e;if(e[t]={},d){const f=a.split(s);for(let g=0;g<f.length;g++){const x=f[g].split(o);let c=x[1];i!==void 0&&c&&(c=c.split(i)),e[t][x[0]]=c||null}}return e}var pt={badges:e=>ce(e,"badges"),badgeInfo:e=>ce(e,"badge-info"),emotes:e=>ce(e,"emotes","/",":",","),emoteRegex(e,t,s,o){ee.lastIndex=0;const i=new RegExp("(\\b|^|\\s)"+le.unescapeHtml(t)+"(\\b|$|\\s)");let a;for(;(a=ee.exec(e))!==null;)i.test(a[0])&&(o[s]=o[s]||[],o[s].push([a.index,ee.lastIndex-1]))},emoteString(e,t,s,o){ee.lastIndex=0;let i;for(;(i=ee.exec(e))!==null;)i[0]===le.unescapeHtml(t)&&(o[s]=o[s]||[],o[s].push([i.index,ee.lastIndex-1]))},transformEmotes(e){let t="";return Object.keys(e).forEach(s=>{t=`${t+s}:`,e[s].forEach(o=>t=`${t+o.join("-")},`),t=`${t.slice(0,-1)}/`}),t.slice(0,-1)},formTags(e){const t=[];for(const s in e){const o=le.escapeIRC(e[s]);t.push(`${s}=${o}`)}return`@${t.join(";")}`},msg(e){const t={raw:e,tags:{},prefix:null,command:null,params:[]};let s=0,o=0;if(e.charCodeAt(0)===64){if(o=e.indexOf(" "),o===-1)return null;const i=e.slice(1,o).split(";");for(let a=0;a<i.length;a++){const d=i[a],f=d.split("=");t.tags[f[0]]=d.substring(d.indexOf("=")+1)||!0}s=o+1}for(;e.charCodeAt(s)===32;)s++;if(e.charCodeAt(s)===58){if(o=e.indexOf(" ",s),o===-1)return null;for(t.prefix=e.slice(s+1,o),s=o+1;e.charCodeAt(s)===32;)s++}if(o=e.indexOf(" ",s),o===-1)return e.length>s?(t.command=e.slice(s),t):null;for(t.command=e.slice(s,o),s=o+1;e.charCodeAt(s)===32;)s++;for(;s<e.length;){if(o=e.indexOf(" ",s),e.charCodeAt(s)===58){t.params.push(e.slice(s+1));break}if(o!==-1){for(t.params.push(e.slice(s,o)),s=o+1;e.charCodeAt(s)===32;)s++;continue}if(o===-1){t.params.push(e.slice(s));break}}return t}};class gt{constructor(t){this.queue=[],this.index=0,this.defaultDelay=t===void 0?3e3:t}add(t,s){this.queue.push({fn:t,delay:s})}next(){const t=this.index++,s=this.queue[t];if(!s)return;const o=this.queue[this.index];if(s.fn(),o){const i=o.delay===void 0?this.defaultDelay:o.delay;setTimeout(()=>this.next(),i)}}}var bt=gt;(function(e){const t=typeof pe<"u"?pe:typeof window<"u"?window:{},s=t.WebSocket||ue,o=t.fetch||ue,i=ct,a=ut,d=dt.EventEmitter,f=ft,g=pt,x=bt,c=ne;let C=!1;const _=function y(r){if(!(this instanceof y))return new y(r);this.opts=c.get(r,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=c.get(this.opts.options.clientId,null),this._globalDefaultChannel=c.channel(c.get(this.opts.options.globalDefaultChannel,"#tmijs")),this._skipMembership=c.get(this.opts.options.skipMembership,!1),this._skipUpdatingEmotesets=c.get(this.opts.options.skipUpdatingEmotesets,!1),this._updateEmotesetsTimer=null,this._updateEmotesetsTimerDelay=c.get(this.opts.options.updateEmotesetsTimer,6e4),this.maxReconnectAttempts=c.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=c.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=c.get(this.opts.connection.reconnect,!0),this.reconnectDecay=c.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=c.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=c.get(this.opts.connection.secure,!this.opts.connection.server&&!this.opts.connection.port),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;let n="error";this.opts.options.debug&&(n="info"),this.log=this.opts.logger||f;try{f.setLevel(n)}catch{}this.opts.channels.forEach((l,w,b)=>b[w]=c.channel(l)),d.call(this),this.setMaxListeners(0)};c.inherits(_,d);for(const y in a)_.prototype[y]=a[y];_.prototype.emits=function(r,n){for(let l=0;l<r.length;l++){const w=l<n.length?n[l]:n[n.length-1];this.emit.apply(this,[r[l]].concat(w))}},_.prototype.api=function(...y){C||(this.log.warn("Client.prototype.api is deprecated and will be removed for version 2.0.0"),C=!0),i(...y)},_.prototype.handleMessage=function(r){if(!r)return;this.listenerCount("raw_message")&&this.emit("raw_message",JSON.parse(JSON.stringify(r)),r);const n=c.channel(c.get(r.params[0],null));let l=c.get(r.params[1],null);const w=c.get(r.tags["msg-id"],null),b=r.tags=g.badges(g.badgeInfo(g.emotes(r.tags)));for(const m in b){if(m==="emote-sets"||m==="ban-duration"||m==="bits")continue;let p=b[m];typeof p=="boolean"?p=null:p==="1"?p=!0:p==="0"?p=!1:typeof p=="string"&&(p=c.unescapeIRC(p)),b[m]=p}if(r.prefix===null)switch(r.command){case"PING":this.emit("ping"),this._isConnected()&&this.ws.send("PONG");break;case"PONG":{const m=new Date;this.currentLatency=(m.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break}default:this.log.warn(`Could not parse message with no prefix:
${JSON.stringify(r,null,4)}`);break}else if(r.prefix==="tmi.twitch.tv")switch(r.command){case"002":case"003":case"004":case"372":case"375":case"CAP":break;case"001":this.username=r.params[0];break;case"376":{this.log.info("Connected to server."),this.userstate[this._globalDefaultChannel]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval(()=>{this._isConnected()&&this.ws.send("PING"),this.latency=new Date,this.pingTimeout=setTimeout(()=>{this.ws!==null&&(this.wasCloseCalled=!1,this.log.error("Ping timeout."),this.ws.close(),clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer))},c.get(this.opts.connection.timeout,9999))},6e4);let m=c.get(this.opts.options.joinInterval,2e3);m<300&&(m=300);const p=new x(m),E=[...new Set([...this.opts.channels,...this.channels])];this.channels=[];for(let T=0;T<E.length;T++){const S=E[T];p.add(()=>{this._isConnected()&&this.join(S).catch(N=>this.log.error(N))})}p.next();break}case"NOTICE":{const m=[null],p=[n,w,l],E=[w],T=[n,!0],S=[n,!1],N=[p,m],k=[p,E],h=`[${n}] ${l}`;switch(w){case"subs_on":this.log.info(`[${n}] This room is now in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribers"],[T,T,m]);break;case"subs_off":this.log.info(`[${n}] This room is no longer in subscribers-only mode.`),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[S,S,m]);break;case"emote_only_on":this.log.info(`[${n}] This room is now in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonly"],[T,m]);break;case"emote_only_off":this.log.info(`[${n}] This room is no longer in emote-only mode.`),this.emits(["emoteonly","_promiseEmoteonlyoff"],[S,m]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info(`[${n}] This room is now in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[T,T,m]);break;case"r9k_off":this.log.info(`[${n}] This room is no longer in r9k mode.`),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[S,S,m]);break;case"room_mods":{const M=l.split(": "),O=(M.length>1?M[1]:"").toLowerCase().split(", ").filter(P=>P);this.emits(["_promiseMods","mods"],[[null,O],[n,O]]);break}case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[n,[]]]);break;case"vips_success":{l.endsWith(".")&&(l=l.slice(0,-1));const M=l.split(": "),O=(M.length>1?M[1]:"").toLowerCase().split(", ").filter(P=>P);this.emits(["_promiseVips","vips"],[[null,O],[n,O]]);break}case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[n,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_anon":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(h),this.emits(["notice","_promiseBan"],k);break;case"ban_success":this.log.info(h),this.emits(["notice","_promiseBan"],N);break;case"usage_clear":this.log.info(h),this.emits(["notice","_promiseClear"],k);break;case"usage_mods":this.log.info(h),this.emits(["notice","_promiseMods"],[p,[w,[]]]);break;case"mod_success":this.log.info(h),this.emits(["notice","_promiseMod"],N);break;case"usage_vips":this.log.info(h),this.emits(["notice","_promiseVips"],[p,[w,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":case"bad_vip_max_vips_reached":case"bad_vip_achievement_incomplete":this.log.info(h),this.emits(["notice","_promiseVip"],[p,[w,[]]]);break;case"vip_success":this.log.info(h),this.emits(["notice","_promiseVip"],N);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(h),this.emits(["notice","_promiseMod"],k);break;case"unmod_success":this.log.info(h),this.emits(["notice","_promiseUnmod"],N);break;case"unvip_success":this.log.info(h),this.emits(["notice","_promiseUnvip"],N);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(h),this.emits(["notice","_promiseUnmod"],k);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(h),this.emits(["notice","_promiseUnvip"],k);break;case"color_changed":this.log.info(h),this.emits(["notice","_promiseColor"],N);break;case"usage_color":case"turbo_only_color":this.log.info(h),this.emits(["notice","_promiseColor"],k);break;case"commercial_success":this.log.info(h),this.emits(["notice","_promiseCommercial"],N);break;case"usage_commercial":case"bad_commercial_error":this.log.info(h),this.emits(["notice","_promiseCommercial"],k);break;case"hosts_remaining":{this.log.info(h);const M=isNaN(l[0])?0:parseInt(l[0]);this.emits(["notice","_promiseHost"],[p,[null,~~M]]);break}case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(h),this.emits(["notice","_promiseHost"],[p,[w,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(h),this.emits(["notice","_promiseR9kbeta"],k);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(h),this.emits(["notice","_promiseR9kbetaoff"],k);break;case"timeout_success":this.log.info(h),this.emits(["notice","_promiseTimeout"],N);break;case"delete_message_success":this.log.info(`[${n} ${l}]`),this.emits(["notice","_promiseDeletemessage"],N);break;case"already_subs_off":case"usage_subs_off":this.log.info(h),this.emits(["notice","_promiseSubscribersoff"],k);break;case"already_subs_on":case"usage_subs_on":this.log.info(h),this.emits(["notice","_promiseSubscribers"],k);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(h),this.emits(["notice","_promiseEmoteonlyoff"],k);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(h),this.emits(["notice","_promiseEmoteonly"],k);break;case"usage_slow_on":this.log.info(h),this.emits(["notice","_promiseSlow"],k);break;case"usage_slow_off":this.log.info(h),this.emits(["notice","_promiseSlowoff"],k);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_anon":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(h),this.emits(["notice","_promiseTimeout"],k);break;case"untimeout_success":case"unban_success":this.log.info(h),this.emits(["notice","_promiseUnban"],N);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(h),this.emits(["notice","_promiseUnban"],k);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(h),this.emits(["notice","_promiseDeletemessage"],k);break;case"usage_unhost":case"not_hosting":this.log.info(h),this.emits(["notice","_promiseUnhost"],k);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted":case"whisper_restricted_recipient":this.log.info(h),this.emits(["notice","_promiseWhisper"],k);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":case"invalid_user":this.log.info(h),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff","_promiseWhisper"],[p,[w,n]]);break;case"msg_rejected":case"msg_rejected_mandatory":this.log.info(h),this.emit("automod",n,w,l);break;case"unrecognized_cmd":this.log.info(h),this.emit("notice",n,w,l);break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":case"unavailable_command":this.log.info(h),this.emit("notice",n,w,l);break;case"host_on":case"host_off":break;default:l.includes("Login unsuccessful")||l.includes("Login authentication failed")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=l,this.log.error(this.reason),this.ws.close()):l.includes("Error logging in")||l.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=l,this.log.error(this.reason),this.ws.close()):l.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):(this.log.warn(`Could not parse NOTICE from tmi.twitch.tv:
${JSON.stringify(r,null,4)}`),this.emit("notice",n,w,l));break}break}case"USERNOTICE":{const m=b["display-name"]||b.login,p=b["msg-param-sub-plan"]||"",E=c.unescapeIRC(c.get(b["msg-param-sub-plan-name"],""))||null,S={prime:p.includes("Prime"),plan:p,planName:E},N=~~(b["msg-param-streak-months"]||0),k=b["msg-param-recipient-display-name"]||b["msg-param-recipient-user-name"],h=~~b["msg-param-mass-gift-count"];switch(b["message-type"]=w,w){case"resub":this.emits(["resub","subanniversary"],[[n,m,N,l,b,S]]);break;case"sub":this.emits(["subscription","sub"],[[n,m,S,l,b]]);break;case"subgift":this.emit("subgift",n,m,N,k,S,b);break;case"anonsubgift":this.emit("anonsubgift",n,N,k,S,b);break;case"submysterygift":this.emit("submysterygift",n,m,h,S,b);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",n,h,S,b);break;case"primepaidupgrade":this.emit("primepaidupgrade",n,m,S,b);break;case"giftpaidupgrade":{const M=b["msg-param-sender-name"]||b["msg-param-sender-login"];this.emit("giftpaidupgrade",n,m,M,b);break}case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",n,m,b);break;case"raid":{const M=b["msg-param-displayName"]||b["msg-param-login"],O=+b["msg-param-viewerCount"];this.emit("raided",n,M,O,b);break}case"ritual":{const M=b["msg-param-ritual-name"];switch(M){case"new_chatter":this.emit("newchatter",n,m,b,l);break;default:this.emit("ritual",M,n,m,b,l);break}break}default:this.emit("usernotice",w,n,b,l);break}break}case"HOSTTARGET":{const m=l.split(" "),p=~~m[1]||0;m[0]==="-"?(this.log.info(`[${n}] Exited host mode.`),this.emits(["unhost","_promiseUnhost"],[[n,p],[null]])):(this.log.info(`[${n}] Now hosting ${m[0]} for ${p} viewer(s).`),this.emit("hosting",n,m[0],p));break}case"CLEARCHAT":if(r.params.length>1){const m=c.get(r.tags["ban-duration"],null);m===null?(this.log.info(`[${n}] ${l} has been banned.`),this.emit("ban",n,l,null,r.tags)):(this.log.info(`[${n}] ${l} has been timed out for ${m} seconds.`),this.emit("timeout",n,l,null,~~m,r.tags))}else this.log.info(`[${n}] Chat was cleared by a moderator.`),this.emits(["clearchat","_promiseClear"],[[n],[null]]);break;case"CLEARMSG":if(r.params.length>1){const m=l,p=b.login;b["message-type"]="messagedeleted",this.log.info(`[${n}] ${p}'s message has been deleted.`),this.emit("messagedeleted",n,p,m,b)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info(`Disconnecting and reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.disconnect().catch(m=>this.log.error(m)),setTimeout(()=>this.connect().catch(m=>this.log.error(m)),this.reconnectTimer);break;case"USERSTATE":r.tags.username=this.username,r.tags["user-type"]==="mod"&&(this.moderators[n]||(this.moderators[n]=[]),this.moderators[n].includes(this.username)||this.moderators[n].push(this.username)),!c.isJustinfan(this.getUsername())&&!this.userstate[n]&&(this.userstate[n]=b,this.lastJoined=n,this.channels.push(n),this.log.info(`Joined ${n}`),this.emit("join",n,c.username(this.getUsername()),!0)),r.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(r.tags["emote-sets"]),this.userstate[n]=b;break;case"GLOBALUSERSTATE":this.globaluserstate=b,this.emit("globaluserstate",b),typeof r.tags["emote-sets"]<"u"&&this._updateEmoteset(r.tags["emote-sets"]);break;case"ROOMSTATE":if(c.channel(this.lastJoined)===n&&this.emit("_promiseJoin",null,n),r.tags.channel=n,this.emit("roomstate",n,r.tags),!c.hasOwn(r.tags,"subs-only")){if(c.hasOwn(r.tags,"slow"))if(typeof r.tags.slow=="boolean"&&!r.tags.slow){const m=[n,!1,0];this.log.info(`[${n}] This room is no longer in slow mode.`),this.emits(["slow","slowmode","_promiseSlowoff"],[m,m,[null]])}else{const m=~~r.tags.slow,p=[n,!0,m];this.log.info(`[${n}] This room is now in slow mode.`),this.emits(["slow","slowmode","_promiseSlow"],[p,p,[null]])}if(c.hasOwn(r.tags,"followers-only"))if(r.tags["followers-only"]==="-1"){const m=[n,!1,0];this.log.info(`[${n}] This room is no longer in followers-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[m,m,[null]])}else{const m=~~r.tags["followers-only"],p=[n,!0,m];this.log.info(`[${n}] This room is now in follower-only mode.`),this.emits(["followersonly","followersmode","_promiseFollowers"],[p,p,[null]])}}break;case"SERVERCHANGE":break;default:this.log.warn(`Could not parse message from tmi.twitch.tv:
${JSON.stringify(r,null,4)}`);break}else if(r.prefix==="jtv")switch(r.command){case"MODE":l==="+o"?(this.moderators[n]||(this.moderators[n]=[]),this.moderators[n].includes(r.params[2])||this.moderators[n].push(r.params[2]),this.emit("mod",n,r.params[2])):l==="-o"&&(this.moderators[n]||(this.moderators[n]=[]),this.moderators[n].filter(m=>m!==r.params[2]),this.emit("unmod",n,r.params[2]));break;default:this.log.warn(`Could not parse message from jtv:
${JSON.stringify(r,null,4)}`);break}else switch(r.command){case"353":this.emit("names",r.params[2],r.params[3].split(" "));break;case"366":break;case"JOIN":{const m=r.prefix.split("!")[0];c.isJustinfan(this.getUsername())&&this.username===m&&(this.lastJoined=n,this.channels.push(n),this.log.info(`Joined ${n}`),this.emit("join",n,m,!0)),this.username!==m&&this.emit("join",n,m,!1);break}case"PART":{let m=!1;const p=r.prefix.split("!")[0];if(this.username===p){m=!0,this.userstate[n]&&delete this.userstate[n];let E=this.channels.indexOf(n);E!==-1&&this.channels.splice(E,1),E=this.opts.channels.indexOf(n),E!==-1&&this.opts.channels.splice(E,1),this.log.info(`Left ${n}`),this.emit("_promisePart",null)}this.emit("part",n,p,m);break}case"WHISPER":{const m=r.prefix.split("!")[0];this.log.info(`[WHISPER] <${m}>: ${l}`),c.hasOwn(r.tags,"username")||(r.tags.username=m),r.tags["message-type"]="whisper";const p=c.channel(r.tags.username);this.emits(["whisper","message"],[[p,r.tags,l,!1]]);break}case"PRIVMSG":if(r.tags.username=r.prefix.split("!")[0],r.tags.username==="jtv"){const m=c.username(l.split(" ")[0]),p=l.includes("auto");if(l.includes("hosting you for")){const E=c.extractNumber(l);this.emit("hosted",n,m,E,p)}else l.includes("hosting you")&&this.emit("hosted",n,m,0,p)}else{const m=c.get(this.opts.options.messagesLogLevel,"info"),p=c.actionMessage(l);if(r.tags["message-type"]=p?"action":"chat",l=p?p[1]:l,c.hasOwn(r.tags,"bits"))this.emit("cheer",n,r.tags,l);else{if(c.hasOwn(r.tags,"msg-id")){if(r.tags["msg-id"]==="highlighted-message"){const E=r.tags["msg-id"];this.emit("redeem",n,r.tags.username,E,r.tags,l)}else if(r.tags["msg-id"]==="skip-subs-mode-message"){const E=r.tags["msg-id"];this.emit("redeem",n,r.tags.username,E,r.tags,l)}}else if(c.hasOwn(r.tags,"custom-reward-id")){const E=r.tags["custom-reward-id"];this.emit("redeem",n,r.tags.username,E,r.tags,l)}p?(this.log[m](`[${n}] *<${r.tags.username}>: ${l}`),this.emits(["action","message"],[[n,r.tags,l,!1]])):(this.log[m](`[${n}] <${r.tags.username}>: ${l}`),this.emits(["chat","message"],[[n,r.tags,l,!1]]))}}break;default:this.log.warn(`Could not parse message:
${JSON.stringify(r,null,4)}`);break}},_.prototype.connect=function(){return new Promise((r,n)=>{this.server=c.get(this.opts.connection.server,"irc-ws.chat.twitch.tv"),this.port=c.get(this.opts.connection.port,80),this.secure&&(this.port=443),this.port===443&&(this.secure=!0),this.reconnectTimer=this.reconnectTimer*this.reconnectDecay,this.reconnectTimer>=this.maxReconnectInterval&&(this.reconnectTimer=this.maxReconnectInterval),this._openConnection(),this.once("_promiseConnect",l=>{l?n(l):r([this.server,~~this.port])})})},_.prototype._openConnection=function(){const r=`${this.secure?"wss":"ws"}://${this.server}:${this.port}/`,n={};"agent"in this.opts.connection&&(n.agent=this.opts.connection.agent),this.ws=new s(r,"irc",n),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},_.prototype._onOpen=function(){this._isConnected()&&(this.log.info(`Connecting to ${this.server} on port ${this.port}..`),this.emit("connecting",this.server,~~this.port),this.username=c.get(this.opts.identity.username,c.justinfan()),this._getToken().then(r=>{const n=c.password(r);this.log.info("Sending authentication to server.."),this.emit("logon");let l="twitch.tv/tags twitch.tv/commands";this._skipMembership||(l+=" twitch.tv/membership"),this.ws.send("CAP REQ :"+l),n?this.ws.send(`PASS ${n}`):c.isJustinfan(this.username)&&this.ws.send("PASS SCHMOOPIIE"),this.ws.send(`NICK ${this.username}`)}).catch(r=>{this.emits(["_promiseConnect","disconnected"],[[r],["Could not get a token."]])}))},_.prototype._getToken=function(){const r=this.opts.identity.password;let n;return typeof r=="function"?(n=r(),n instanceof Promise?n:Promise.resolve(n)):Promise.resolve(r)},_.prototype._onMessage=function(r){r.data.trim().split(`\r
`).forEach(l=>{const w=g.msg(l);w&&this.handleMessage(w)})},_.prototype._onError=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.reason=this.ws===null?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect().catch(r=>this.log.error(r))},this.reconnectTimer)),this.ws=null},_.prototype._onClose=function(){this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),clearTimeout(this._updateEmotesetsTimer),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error(`Could not connect to server. Reconnecting in ${Math.round(this.reconnectTimer/1e3)} seconds..`),this.emit("reconnect"),setTimeout(()=>{this.reconnecting=!1,this.connect().catch(r=>this.log.error(r))},this.reconnectTimer))),this.ws=null},_.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},_.prototype._sendCommand=function(r,n,l,w){return new Promise((b,m)=>{if(this._isConnected())(r===null||typeof r=="number")&&(r===null&&(r=this._getPromiseDelay()),c.promiseDelay(r).then(()=>m("No response from Twitch.")));else return m("Not connected to server.");if(n!==null){const p=c.channel(n);this.log.info(`[${p}] Executing command: ${l}`),this.ws.send(`PRIVMSG ${p} :${l}`)}else this.log.info(`Executing command: ${l}`),this.ws.send(l);typeof w=="function"?w(b,m):b()})},_.prototype._sendMessage=function(r,n,l,w){return new Promise((b,m)=>{if(this._isConnected()){if(c.isJustinfan(this.getUsername()))return m("Cannot send anonymous messages.")}else return m("Not connected to server.");const p=c.channel(n);if(this.userstate[p]||(this.userstate[p]={}),l.length>=500){const k=c.splitLine(l,500);l=k[0],setTimeout(()=>{this._sendMessage(r,n,k[1],()=>{})},350)}this.ws.send(`PRIVMSG ${p} :${l}`);const E={};Object.keys(this.emotesets).forEach(k=>this.emotesets[k].forEach(h=>(c.isRegex(h.code)?g.emoteRegex:g.emoteString)(l,h.code,h.id,E)));const T=Object.assign(this.userstate[p],g.emotes({emotes:g.transformEmotes(E)||null})),S=c.get(this.opts.options.messagesLogLevel,"info"),N=c.actionMessage(l);N?(T["message-type"]="action",this.log[S](`[${p}] *<${this.getUsername()}>: ${N[1]}`),this.emits(["action","message"],[[p,T,N[1],!0]])):(T["message-type"]="chat",this.log[S](`[${p}] <${this.getUsername()}>: ${l}`),this.emits(["chat","message"],[[p,T,l,!0]])),typeof w=="function"?w(b,m):b()})},_.prototype._updateEmoteset=function(r){let n=r!==void 0;if(n&&(r===this.emotes?n=!1:this.emotes=r),this._skipUpdatingEmotesets){n&&this.emit("emotesets",r,{});return}const l=()=>{this._updateEmotesetsTimerDelay>0&&(clearTimeout(this._updateEmotesetsTimer),this._updateEmotesetsTimer=setTimeout(()=>this._updateEmoteset(r),this._updateEmotesetsTimerDelay))};this._getToken().then(w=>{const b=`https://api.twitch.tv/kraken/chat/emoticon_images?emotesets=${r}`,m={};return"fetchAgent"in this.opts.connection&&(m.agent=this.opts.connection.fetchAgent),o(b,{...m,headers:{Accept:"application/vnd.twitchtv.v5+json",Authorization:`OAuth ${c.token(w)}`,"Client-ID":this.clientId}})}).then(w=>w.json()).then(w=>{this.emotesets=w.emoticon_sets||{},this.emit("emotesets",r,this.emotesets),l()}).catch(()=>l())},_.prototype.getUsername=function(){return this.username},_.prototype.getOptions=function(){return this.opts},_.prototype.getChannels=function(){return this.channels},_.prototype.isMod=function(r,n){const l=c.channel(r);return this.moderators[l]||(this.moderators[l]=[]),this.moderators[l].includes(c.username(n))},_.prototype.readyState=function(){return this.ws===null?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},_.prototype._isConnected=function(){return this.ws!==null&&this.ws.readyState===1},_.prototype.disconnect=function(){return new Promise((r,n)=>{this.ws!==null&&this.ws.readyState!==3?(this.wasCloseCalled=!0,this.log.info("Disconnecting from server.."),this.ws.close(),this.once("_promiseDisconnect",()=>r([this.server,~~this.port]))):(this.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),n("Cannot disconnect from server. Socket is not opened or connection is already closing."))})},_.prototype.off=_.prototype.removeListener,e.exports&&(e.exports=_),typeof window<"u"&&(window.tmi={client:_,Client:_})})(Ge);var _t=Ge.exports;const Ee=_t;var vt={client:Ee,Client:Ee};const xt=Ke(vt);function Ne(e,t,s){return Math.min(Math.max(t,e),s)}function Me(e,t,s){return(t-e)*s+e}function wt(){for(var e=0,t,s,o="";e<arguments.length;)(t=arguments[e++])&&(s=Ve(t))&&(o&&(o+=" "),o+=s);return o}function Ve(e){if(typeof e=="string")return e;for(var t,s="",o=0;o<e.length;o++)e[o]&&(t=Ve(e[o]))&&(s&&(s+=" "),s+=t);return s}var me="-";function yt(e){var t=kt(e),s=e.conflictingClassGroups,o=e.conflictingClassGroupModifiers,i=o===void 0?{}:o;function a(f){var g=f.split(me);return g[0]===""&&g.length!==1&&g.shift(),We(g,t)||Ct(f)}function d(f,g){var x=s[f]||[];return g&&i[f]?[].concat(x,i[f]):x}return{getClassGroupId:a,getConflictingClassGroupIds:d}}function We(e,t){var d;if(e.length===0)return t.classGroupId;var s=e[0],o=t.nextPart.get(s),i=o?We(e.slice(1),o):void 0;if(i)return i;if(t.validators.length!==0){var a=e.join(me);return(d=t.validators.find(function(f){var g=f.validator;return g(a)}))==null?void 0:d.classGroupId}}var je=/^\[(.+)\]$/;function Ct(e){if(je.test(e)){var t=je.exec(e)[1],s=t==null?void 0:t.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}}function kt(e){var t=e.theme,s=e.prefix,o={nextPart:new Map,validators:[]},i=St(Object.entries(e.classGroups),s);return i.forEach(function(a){var d=a[0],f=a[1];de(f,o,d,t)}),o}function de(e,t,s,o){e.forEach(function(i){if(typeof i=="string"){var a=i===""?t:Ie(t,i);a.classGroupId=s;return}if(typeof i=="function"){if(Tt(i)){de(i(o),t,s,o);return}t.validators.push({validator:i,classGroupId:s});return}Object.entries(i).forEach(function(d){var f=d[0],g=d[1];de(g,Ie(t,f),s,o)})})}function Ie(e,t){var s=e;return t.split(me).forEach(function(o){s.nextPart.has(o)||s.nextPart.set(o,{nextPart:new Map,validators:[]}),s=s.nextPart.get(o)}),s}function Tt(e){return e.isThemeGetter}function St(e,t){return t?e.map(function(s){var o=s[0],i=s[1],a=i.map(function(d){return typeof d=="string"?t+d:typeof d=="object"?Object.fromEntries(Object.entries(d).map(function(f){var g=f[0],x=f[1];return[t+g,x]})):d});return[o,a]}):e}function Et(e){if(e<1)return{get:function(){},set:function(){}};var t=0,s=new Map,o=new Map;function i(a,d){s.set(a,d),t++,t>e&&(t=0,o=s,s=new Map)}return{get:function(d){var f=s.get(d);if(f!==void 0)return f;if((f=o.get(d))!==void 0)return i(d,f),f},set:function(d,f){s.has(d)?s.set(d,f):i(d,f)}}}var He="!";function Nt(e){var t=e.separator||":",s=t.length===1,o=t[0],i=t.length;return function(d){for(var f=[],g=0,x=0,c,C=0;C<d.length;C++){var _=d[C];if(g===0){if(_===o&&(s||d.slice(C,C+i)===t)){f.push(d.slice(x,C)),x=C+i;continue}if(_==="/"){c=C;continue}}_==="["?g++:_==="]"&&g--}var y=f.length===0?d:d.substring(x),r=y.startsWith(He),n=r?y.substring(1):y,l=c&&c>x?c-x:void 0;return{modifiers:f,hasImportantModifier:r,baseClassName:n,maybePostfixModifierPosition:l}}}function Mt(e){if(e.length<=1)return e;var t=[],s=[];return e.forEach(function(o){var i=o[0]==="[";i?(t.push.apply(t,s.sort().concat([o])),s=[]):s.push(o)}),t.push.apply(t,s.sort()),t}function jt(e){return{cache:Et(e.cacheSize),splitModifiers:Nt(e),...yt(e)}}var It=/\s+/;function $t(e,t){var s=t.splitModifiers,o=t.getClassGroupId,i=t.getConflictingClassGroupIds,a=new Set;return e.trim().split(It).map(function(d){var f=s(d),g=f.modifiers,x=f.hasImportantModifier,c=f.baseClassName,C=f.maybePostfixModifierPosition,_=o(C?c.substring(0,C):c),y=!!C;if(!_){if(!C)return{isTailwindClass:!1,originalClassName:d};if(_=o(c),!_)return{isTailwindClass:!1,originalClassName:d};y=!1}var r=Mt(g).join(":"),n=x?r+He:r;return{isTailwindClass:!0,modifierId:n,classGroupId:_,originalClassName:d,hasPostfixModifier:y}}).reverse().filter(function(d){if(!d.isTailwindClass)return!0;var f=d.modifierId,g=d.classGroupId,x=d.hasPostfixModifier,c=f+g;return a.has(c)?!1:(a.add(c),i(g,x).forEach(function(C){return a.add(f+C)}),!0)}).reverse().map(function(d){return d.originalClassName}).join(" ")}function Lt(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];var o,i,a,d=f;function f(x){var c=t[0],C=t.slice(1),_=C.reduce(function(y,r){return r(y)},c());return o=jt(_),i=o.cache.get,a=o.cache.set,d=g,g(x)}function g(x){var c=i(x);if(c)return c;var C=$t(x,o);return a(x,C),C}return function(){return d(wt.apply(null,arguments))}}function I(e){var t=function(o){return o[e]||[]};return t.isThemeGetter=!0,t}var Je=/^\[(?:([a-z-]+):)?(.+)\]$/i,At=/^\d+\/\d+$/,Rt=new Set(["px","full","screen"]),Ot=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ut=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|^0$/,Pt=/^-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/;function D(e){return Z(e)||Rt.has(e)||At.test(e)||q(e)}function q(e){return X(e,"length",Vt)}function zt(e){return X(e,"size",qe)}function Gt(e){return X(e,"position",qe)}function Dt(e){return X(e,"url",Wt)}function ae(e){return X(e,"number",Z)}function Z(e){return!Number.isNaN(Number(e))}function Bt(e){return e.endsWith("%")&&Z(e.slice(0,-1))}function te(e){return $e(e)||X(e,"number",$e)}function $(e){return Je.test(e)}function se(){return!0}function J(e){return Ot.test(e)}function Ft(e){return X(e,"",Ht)}function X(e,t,s){var o=Je.exec(e);return o?o[1]?o[1]===t:s(o[2]):!1}function Vt(e){return Ut.test(e)}function qe(){return!1}function Wt(e){return e.startsWith("url(")}function $e(e){return Number.isInteger(Number(e))}function Ht(e){return Pt.test(e)}function Jt(){var e=I("colors"),t=I("spacing"),s=I("blur"),o=I("brightness"),i=I("borderColor"),a=I("borderRadius"),d=I("borderSpacing"),f=I("borderWidth"),g=I("contrast"),x=I("grayscale"),c=I("hueRotate"),C=I("invert"),_=I("gap"),y=I("gradientColorStops"),r=I("gradientColorStopPositions"),n=I("inset"),l=I("margin"),w=I("opacity"),b=I("padding"),m=I("saturate"),p=I("scale"),E=I("sepia"),T=I("skew"),S=I("space"),N=I("translate"),k=function(){return["auto","contain","none"]},h=function(){return["auto","hidden","clip","visible","scroll"]},M=function(){return["auto",t]},O=function(){return["",D]},P=function(){return["auto",Z,$]},z=function(){return["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"]},A=function(){return["solid","dashed","dotted","double","none"]},Q=function(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"]},G=function(){return["start","end","center","between","around","evenly","stretch"]},B=function(){return["","0",$]},Y=function(){return["auto","avoid","all","avoid-page","page","left","right","column"]},F=function(){return[Z,ae]},j=function(){return[Z,$]};return{cacheSize:500,theme:{colors:[se],spacing:[D],blur:["none","",J,q],brightness:F(),borderColor:[e],borderRadius:["none","","full",J,q],borderSpacing:[t],borderWidth:O(),contrast:F(),grayscale:B(),hueRotate:j(),invert:B(),gap:[t],gradientColorStops:[e],gradientColorStopPositions:[Bt,q],inset:M(),margin:M(),opacity:F(),padding:[t],saturate:F(),scale:F(),sepia:B(),skew:j(),space:[t],translate:[t]},classGroups:{aspect:[{aspect:["auto","square","video",$]}],container:["container"],columns:[{columns:[J]}],"break-after":[{"break-after":Y()}],"break-before":[{"break-before":Y()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none"]}],clear:[{clear:["left","right","both","none"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[].concat(z(),[$])}],overflow:[{overflow:h()}],"overflow-x":[{"overflow-x":h()}],"overflow-y":[{"overflow-y":h()}],overscroll:[{overscroll:k()}],"overscroll-x":[{"overscroll-x":k()}],"overscroll-y":[{"overscroll-y":k()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[n]}],"inset-x":[{"inset-x":[n]}],"inset-y":[{"inset-y":[n]}],start:[{start:[n]}],end:[{end:[n]}],top:[{top:[n]}],right:[{right:[n]}],bottom:[{bottom:[n]}],left:[{left:[n]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",te]}],basis:[{basis:M()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",$]}],grow:[{grow:B()}],shrink:[{shrink:B()}],order:[{order:["first","last","none",te]}],"grid-cols":[{"grid-cols":[se]}],"col-start-end":[{col:["auto",{span:[te]},$]}],"col-start":[{"col-start":P()}],"col-end":[{"col-end":P()}],"grid-rows":[{"grid-rows":[se]}],"row-start-end":[{row:["auto",{span:[te]},$]}],"row-start":[{"row-start":P()}],"row-end":[{"row-end":P()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",$]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",$]}],gap:[{gap:[_]}],"gap-x":[{"gap-x":[_]}],"gap-y":[{"gap-y":[_]}],"justify-content":[{justify:["normal"].concat(G())}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal"].concat(G(),["baseline"])}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[].concat(G(),["baseline"])}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[l]}],mx:[{mx:[l]}],my:[{my:[l]}],ms:[{ms:[l]}],me:[{me:[l]}],mt:[{mt:[l]}],mr:[{mr:[l]}],mb:[{mb:[l]}],ml:[{ml:[l]}],"space-x":[{"space-x":[S]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[S]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit",t]}],"min-w":[{"min-w":["min","max","fit",D]}],"max-w":[{"max-w":["0","none","full","min","max","fit","prose",{screen:[J]},J,q]}],h:[{h:[t,"auto","min","max","fit"]}],"min-h":[{"min-h":["min","max","fit",D]}],"max-h":[{"max-h":[t,"min","max","fit"]}],"font-size":[{text:["base",J,q]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",ae]}],"font-family":[{font:[se]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",q]}],"line-clamp":[{"line-clamp":["none",Z,ae]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",D]}],"list-image":[{"list-image":["none",$]}],"list-style-type":[{list:["none","disc","decimal",$]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[].concat(A(),["wavy"])}],"text-decoration-thickness":[{decoration:["auto","from-font",D]}],"underline-offset":[{"underline-offset":["auto",D]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],indent:[{indent:[t]}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",q]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",$]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[].concat(z(),[Gt])}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",zt]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Dt]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[r]}],"gradient-via-pos":[{via:[r]}],"gradient-to-pos":[{to:[r]}],"gradient-from":[{from:[y]}],"gradient-via":[{via:[y]}],"gradient-to":[{to:[y]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[f]}],"border-w-x":[{"border-x":[f]}],"border-w-y":[{"border-y":[f]}],"border-w-s":[{"border-s":[f]}],"border-w-e":[{"border-e":[f]}],"border-w-t":[{"border-t":[f]}],"border-w-r":[{"border-r":[f]}],"border-w-b":[{"border-b":[f]}],"border-w-l":[{"border-l":[f]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[].concat(A(),["hidden"])}],"divide-x":[{"divide-x":[f]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[f]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:A()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:[""].concat(A())}],"outline-offset":[{"outline-offset":[D]}],"outline-w":[{outline:[D]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:O()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[D]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",J,Ft]}],"shadow-color":[{shadow:[se]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":Q()}],"bg-blend":[{"bg-blend":Q()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[o]}],contrast:[{contrast:[g]}],"drop-shadow":[{"drop-shadow":["","none",J,$]}],grayscale:[{grayscale:[x]}],"hue-rotate":[{"hue-rotate":[c]}],invert:[{invert:[C]}],saturate:[{saturate:[m]}],sepia:[{sepia:[E]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[o]}],"backdrop-contrast":[{"backdrop-contrast":[g]}],"backdrop-grayscale":[{"backdrop-grayscale":[x]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[c]}],"backdrop-invert":[{"backdrop-invert":[C]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[m]}],"backdrop-sepia":[{"backdrop-sepia":[E]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[d]}],"border-spacing-x":[{"border-spacing-x":[d]}],"border-spacing-y":[{"border-spacing-y":[d]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",$]}],duration:[{duration:j()}],ease:[{ease:["linear","in","out","in-out",$]}],delay:[{delay:j()}],animate:[{animate:["none","spin","ping","pulse","bounce",$]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[p]}],"scale-x":[{"scale-x":[p]}],"scale-y":[{"scale-y":[p]}],rotate:[{rotate:[te,$]}],"translate-x":[{"translate-x":[N]}],"translate-y":[{"translate-y":[N]}],"skew-x":[{"skew-x":[T]}],"skew-y":[{"skew-y":[T]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",$]}],accent:[{accent:["auto",e]}],appearance:["appearance-none"],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",$]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":[t]}],"scroll-mx":[{"scroll-mx":[t]}],"scroll-my":[{"scroll-my":[t]}],"scroll-ms":[{"scroll-ms":[t]}],"scroll-me":[{"scroll-me":[t]}],"scroll-mt":[{"scroll-mt":[t]}],"scroll-mr":[{"scroll-mr":[t]}],"scroll-mb":[{"scroll-mb":[t]}],"scroll-ml":[{"scroll-ml":[t]}],"scroll-p":[{"scroll-p":[t]}],"scroll-px":[{"scroll-px":[t]}],"scroll-py":[{"scroll-py":[t]}],"scroll-ps":[{"scroll-ps":[t]}],"scroll-pe":[{"scroll-pe":[t]}],"scroll-pt":[{"scroll-pt":[t]}],"scroll-pr":[{"scroll-pr":[t]}],"scroll-pb":[{"scroll-pb":[t]}],"scroll-pl":[{"scroll-pl":[t]}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","pinch-zoom","manipulation",{pan:["x","left","right","y","up","down"]}]}],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",$]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[D,ae]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}var he=Lt(Jt);const qt=e=>u.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 340.274 340.274",fill:"currentColor",...e,children:u.jsx("path",{d:`M293.629,127.806l-5.795-13.739c19.846-44.856,18.53-46.189,14.676-50.08l-25.353-24.77l-2.516-2.12h-2.937
				c-1.549,0-6.173,0-44.712,17.48l-14.184-5.719c-18.332-45.444-20.212-45.444-25.58-45.444h-35.765
				c-5.362,0-7.446-0.006-24.448,45.606l-14.123,5.734C86.848,43.757,71.574,38.19,67.452,38.19l-3.381,0.105L36.801,65.032
				c-4.138,3.891-5.582,5.263,15.402,49.425l-5.774,13.691C0,146.097,0,147.838,0,153.33v35.068c0,5.501,0,7.44,46.585,24.127
				l5.773,13.667c-19.843,44.832-18.51,46.178-14.655,50.032l25.353,24.8l2.522,2.168h2.951c1.525,0,6.092,0,44.685-17.516
				l14.159,5.758c18.335,45.438,20.218,45.427,25.598,45.427h35.771c5.47,0,7.41,0,24.463-45.589l14.195-5.74
				c26.014,11,41.253,16.585,45.349,16.585l3.404-0.096l27.479-26.901c3.909-3.945,5.278-5.309-15.589-49.288l5.734-13.702
				c46.496-17.967,46.496-19.853,46.496-25.221v-35.029C340.268,146.361,340.268,144.434,293.629,127.806z M170.128,228.474
				c-32.798,0-59.504-26.187-59.504-58.364c0-32.153,26.707-58.315,59.504-58.315c32.78,0,59.43,26.168,59.43,58.315
				C229.552,202.287,202.902,228.474,170.128,228.474z`})}),Qt=qt,Zt=e=>u.jsx("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",...e,children:u.jsx("path",{d:"M12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM15.36 14.3C15.65 14.59 15.65 15.07 15.36 15.36C15.21 15.51 15.02 15.58 14.83 15.58C14.64 15.58 14.45 15.51 14.3 15.36L12 13.06L9.7 15.36C9.55 15.51 9.36 15.58 9.17 15.58C8.98 15.58 8.79 15.51 8.64 15.36C8.35 15.07 8.35 14.59 8.64 14.3L10.94 12L8.64 9.7C8.35 9.41 8.35 8.93 8.64 8.64C8.93 8.35 9.41 8.35 9.7 8.64L12 10.94L14.3 8.64C14.59 8.35 15.07 8.35 15.36 8.64C15.65 8.93 15.65 9.41 15.36 9.7L13.06 12L15.36 14.3Z"})}),Qe=Zt,Xt=({variant:e="high",...t})=>u.jsx("svg",{fill:"currentColor",width:"1em",height:"1em",viewBox:"-1 0 19 19",...t,children:e==="mute"?u.jsx("path",{d:"M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zM7.84 6.05c0-.435-.252-.54-.56-.232L5.16 7.94H3.704a.794.794 0 0 0-.791.793v1.686a.794.794 0 0 0 .791.792h1.457l2.12 2.12c.308.308.56.204.56-.232zm3.84 3.524 1.49-1.49a.396.396 0 0 0-.56-.56l-1.49 1.49-1.49-1.49a.396.396 0 0 0-.56.56l1.49 1.49-1.49 1.49a.396.396 0 1 0 .56.56l1.49-1.49 1.49 1.49a.396.396 0 0 0 .56-.56z"}):e==="low"?u.jsx("path",{d:"M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zM7.84 6.06c0-.435-.252-.54-.56-.231l-2.12 2.12H3.705a.794.794 0 0 0-.792.792v1.686a.794.794 0 0 0 .792.792H5.16l2.12 2.12c.308.308.56.204.56-.231zm2.543 3.524a2.547 2.547 0 0 0-.75-1.813.396.396 0 1 0-.56.56 1.773 1.773 0 0 1 0 2.506.396.396 0 1 0 .56.56 2.546 2.546 0 0 0 .75-1.813z"}):e==="medium"?u.jsx("path",{d:"M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zM7.84 6.06c0-.435-.252-.54-.56-.231l-2.12 2.12H3.704a.794.794 0 0 0-.791.792v1.686a.794.794 0 0 0 .791.792h1.457l2.12 2.12c.308.308.56.204.56-.231zm1.792 5.337a2.564 2.564 0 0 0 0-3.626.396.396 0 1 0-.56.56 1.773 1.773 0 0 1 0 2.506.396.396 0 1 0 .56.56zm2.597-1.813a4.38 4.38 0 0 0-1.292-3.118.396.396 0 0 0-.56.56 3.618 3.618 0 0 1 0 5.116.396.396 0 1 0 .56.56 4.38 4.38 0 0 0 1.292-3.118z"}):e==="high"?u.jsx("path",{d:"M16.417 9.583A7.917 7.917 0 1 1 8.5 1.666a7.917 7.917 0 0 1 7.917 7.917zM7.84 6.06c0-.435-.252-.54-.56-.232l-2.12 2.12H3.704a.794.794 0 0 0-.791.792v1.687a.794.794 0 0 0 .791.792h1.457l2.12 2.12c.308.308.56.204.56-.232zm1.792 5.336a2.566 2.566 0 0 0 0-3.625.396.396 0 0 0-.56.56 1.775 1.775 0 0 1 0 2.506.396.396 0 1 0 .56.56zm1.305 1.305a4.41 4.41 0 0 0 0-6.235.396.396 0 0 0-.56.56 3.618 3.618 0 0 1 0 5.116.396.396 0 1 0 .56.56zm2.68-.764a6.25 6.25 0 0 0-1.375-6.776.396.396 0 1 0-.56.56 5.464 5.464 0 0 1 0 7.726.396.396 0 1 0 .56.56 6.216 6.216 0 0 0 1.374-2.07z"}):null}),Yt=Xt;var V=(e=>(e.IDLE="IDLE",e.STARTED="STARTED",e.GAME_OVER="GAME_OVER",e))(V||{});const Kt=Oe(Ue(e=>({status:"IDLE",number:0,user:"",maxScore:0,maxScoreUser:"",setGameState:t=>{e(t)},resetGame:()=>e({maxScore:0,maxScoreUser:"",number:0,user:"",status:"IDLE"})}),{name:"numerica",version:1})),Ze=Kt;function es(){const{channel:e,setChannel:t,volume:s,setVolume:o,enableTimeout:i,setEnableTimeout:a,timeoutMultiplier:d,setTimeoutMultiplier:f,timeoutBase:g,setTimeoutBase:x,timeoutReason:c,setTimeoutReason:C,banMods:_,setBanMods:y}=W(),{isAuthenticated:r,goToLogin:n,logOut:l}=Pe(),w=Ze(T=>T.resetGame),[b,m]=L.useState(!1),[p,E]=L.useState(!1);return u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsxs("fieldset",{children:[u.jsx("legend",{children:"Channel"}),u.jsx("input",{type:"text",name:"channel",className:"block w-full rounded-md border-0 py-1 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary text-2xl sm:leading-6",placeholder:"Nombre de twitch...",value:e,onChange:T=>t(T.target.value)})]}),u.jsxs("fieldset",{children:[u.jsx("legend",{children:"Bubble Sounds"}),u.jsxs("div",{className:"flex flex-row items-center gap-2 py-1",children:[u.jsx(Yt,{className:"text-4xl",variant:s===0?"mute":s<.25?"low":s<.75?"medium":"high"}),u.jsx("input",{className:"accent-primary w-full",type:"range",min:0,max:1,step:.01,value:s,onChange:T=>o(parseFloat(T.target.value))}),u.jsxs("span",{className:"w-[5ch] text-end",children:[Math.round(s*100),"%"]})]})]}),r?u.jsxs(u.Fragment,{children:[u.jsxs("fieldset",{children:[u.jsx("legend",{children:"Enable Timeout"}),u.jsx("input",{className:"accent-primary",id:"enable-timeout",type:"checkbox",checked:i,onChange:T=>a(T.target.checked)})]}),i&&u.jsxs(u.Fragment,{children:[u.jsxs("fieldset",{children:[u.jsx("legend",{children:"Timeout Multiplier"}),u.jsx("input",{type:"number",name:"timeout-multiplier",className:"block w-full rounded-md border-0 py-1 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary text-2xl sm:leading-6",placeholder:"Timeout Multiplier",value:d,onChange:T=>{const S=Number(T.target.value),N=Number.isFinite(S),k=S>=0,h=Number.isInteger(S);N&&k&&h&&f(S)}})]}),u.jsxs("fieldset",{children:[u.jsx("legend",{children:"Timeout Base"}),u.jsx("input",{type:"number",name:"timeout-base",className:"block w-full rounded-md border-0 py-1 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary text-2xl sm:leading-6",placeholder:"Timeout Base",value:g,onChange:T=>{const S=Number(T.target.value),N=Number.isFinite(S),k=S>=0,h=Number.isInteger(S);N&&k&&h&&x(S)}})]}),u.jsxs("fieldset",{title:"Customize your ban message",children:[u.jsx("legend",{children:"Timeout Reason"}),u.jsx("input",{type:"text",name:"timeout-reason",className:"block w-full rounded-md border-0 py-1 px-2 text-gray-900 ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-primary text-2xl sm:leading-6",placeholder:"Numerica Rothio Skin - Timeout",value:c,onChange:T=>C(T.target.value)})]}),u.jsxs("fieldset",{title:"Enable o dissable moderator ban",children:[u.jsx("legend",{children:"Ban Mods"}),u.jsx("input",{className:"accent-primary",id:"enable-timeout",type:"checkbox",checked:_,onChange:T=>y(T.target.checked)})]}),u.jsxs("fieldset",{title:"Are you brave enough? >:)",children:[u.jsx("legend",{children:"Super secret setting"}),u.jsx("input",{className:"accent-primary",id:"enable-timeout",type:"checkbox"})]})]}),u.jsx("button",{className:"w-full py-2 px-4 bg-secondary text-black rounded-2xl",onClick:()=>m(!0),children:"Clear data & reset"}),u.jsx("button",{className:"w-full py-2 px-4 bg-primary text-white rounded-2xl",onClick:()=>E(!0),children:"LogOut"})]}):u.jsx("button",{className:"w-full py-2 px-4 bg-primary text-white rounded-2xl",onClick:n,children:"Login With Twitch"}),b&&u.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:u.jsxs("div",{className:"bg-slate-700 rounded-2xl p-6 flex flex-col gap-4 max-w-sm mx-4",children:[u.jsx("p",{className:"text-white text-center text-lg",children:"Are you sure you want to clear all data?"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{className:"flex-1 py-2 px-4 bg-slate-500 text-white rounded-2xl",onClick:()=>m(!1),children:"Cancel"}),u.jsx("button",{className:"flex-1 py-2 px-4 bg-secondary text-black rounded-2xl",onClick:()=>{w(),m(!1)},children:"Yes, please"})]})]})}),p&&u.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:u.jsxs("div",{className:"bg-slate-700 rounded-2xl p-6 flex flex-col gap-4 max-w-sm mx-4",children:[u.jsx("p",{className:"text-white text-center text-lg",children:"Are you sure you want to logout?"}),u.jsxs("div",{className:"flex gap-2",children:[u.jsx("button",{className:"flex-1 py-2 px-4 bg-slate-500 text-white rounded-2xl",onClick:()=>E(!1),children:"Nope"}),u.jsx("button",{className:"flex-1 py-2 px-4 bg-secondary text-black rounded-2xl",onClick:()=>{l(),E(!1)},children:"Logout"})]})]})})]})}function ts(){const e=W(i=>i.channel),[t,s]=L.useState(!e),o=()=>s(i=>!i);return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"absolute bottom-0 right-0 border-2 border-primary p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-4lg outline-none",onClick:o,children:u.jsx(Qt,{})}),u.jsxs("div",{className:he("fixed bottom-0 right-0 bg-primary-dark w-screen h-screen z-20 transition-transform duration-200 flex justify-center items-center font-black",t?"translate-y-0 pointer-events-auto":"translate-y-full pointer-events-none"),children:[u.jsx("button",{className:"absolute top-2 right-2 border-2 border-primary text-primary p-2 rounded-lg",onClick:o,children:u.jsx(Qe,{})}),u.jsx(es,{})]})]})}const ss=Oe(Ue(e=>({numbersSubmited:0,numbersFailed:0,timeoutedUsers:{},activeUsers:{},maxTimeoutValue:0,maxTimeoutUser:"-",maxScore:0,maxScoreUser:"-",setStatsMaxScore:(t,s)=>{e(o=>t>o.maxScore?{maxScore:t,maxScoreUser:s}:{})},setStatsMaxTimeout:(t,s)=>{e(o=>t>o.maxTimeoutValue?{maxTimeoutValue:t,maxTimeoutUser:s}:{})},setStatsTimeoutedUser:t=>e(s=>({numbersFailed:s.numbersFailed+1,timeoutedUsers:{...s.timeoutedUsers,[t]:(s.timeoutedUsers[t]||0)+1}})),setStatsNumberSubmitedBy:t=>e(s=>({numbersSubmited:s.numbersSubmited+1,activeUsers:{...s.activeUsers,[t]:(s.activeUsers[t]||0)+1}})),getMaxValueOf:t=>{let s="",o=-1/0;for(const[i,a]of Object.entries(t))a>o&&(o=a,s=i);return s}}),{name:"numerica-stats",version:1})),Xe=ss,{VITE_TWITCH_CLIENT_ID:os}={VITE_TWITCH_CLIENT_ID:"xzi048c3hadw8527pkiqvfwd2dz3gm",BASE_URL:"/numerica-rothio-skin/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},ns=()=>{const{accessToken:e}=ze(),[t,s]=L.useState(!1),[o,i]=L.useState(null);return[L.useCallback(async({broadcasterId:d,moderatorId:f,userId:g,duration:x,reason:c})=>{s(!0),i(null);try{console.log({broadcasterId:d,moderatorId:f,userId:g,duration:x,reason:c});const C=new URL("https://api.twitch.tv/helix/moderation/bans");C.searchParams.append("broadcaster_id",d),C.searchParams.append("moderator_id",f);const _=await fetch(C.toString(),{method:"POST",headers:{"Content-Type":"application/json","Client-Id":os,Authorization:`Bearer ${e}`},body:JSON.stringify({data:{user_id:g,duration:x<1?1:x,reason:c||"Numerica Rothio Skin - Timeout"}})});if(!_.ok)throw new Error(_.statusText);return await _.json()}catch(C){i(C)}finally{s(!1)}},[]),{loading:t,error:o}]},is=ns,{VITE_TWITCH_CLIENT_ID:rs}={VITE_TWITCH_CLIENT_ID:"xzi048c3hadw8527pkiqvfwd2dz3gm",BASE_URL:"/numerica-rothio-skin/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},as=()=>{const{accessToken:e}=ze(),[t,s]=L.useState(!1),[o,i]=L.useState(null),[a,d]=L.useState(null);return[L.useCallback(async({username:g})=>{s(!0),i(null);try{const x=new URL("https://api.twitch.tv/helix/users");x.searchParams.append("login",g);const c=await fetch(x.toString(),{method:"GET",headers:{"Content-Type":"application/json","Client-Id":rs,Authorization:`Bearer ${e}`}});if(!c.ok)throw new Error(c.statusText);const _=(await c.json()).data[0];return d(_),_}catch(x){i(x)}finally{s(!1)}},[]),{loading:t,error:o,data:a}]},ls=as,cs=e=>u.jsxs("svg",{width:"1em",height:"1em",viewBox:"0 0 124 124",fill:"currentColor",...e,children:[u.jsx("path",{d:"M43.05,63h-12c-3.3,0-6,2.7-6,6v24c0,3.3,2.7,6,6,6h12c3.3,0,6-2.7,6-6V69C49.05,65.7,46.35,63,43.05,63z"}),u.jsx("path",{d:"M64.05,46c-3.3,0-6,2.7-6,6v41c0,3.3,2.7,6,6,6h12c3.3,0,6-2.7,6-6V52c0-3.3-2.7-6-6-6H64.05z"}),u.jsx("path",{d:"M109.05,46h-12c-3.3,0-6,2.7-6,6v41c0,3.3,2.7,6,6,6h12c3.3,0,6-2.7,6-6V52C115.05,48.7,112.35,46,109.05,46z"}),u.jsx("path",{d:`M6.55,124h111.9c3.3,0,5.5-3.2,5.5-6.5v-2c0-3.3-2.2-6.4-5.5-6.4h-97.7c-3.3,0-5.7-2.3-5.7-5.699V5.5
        c0-3.3-3.1-5.5-6.4-5.5h-2c-3.4,0-6.6,2.2-6.6,5.5v111.9C0.05,120.8,3.25,124,6.55,124z`})]}),us=cs;function ds(){const{maxScore:e,maxScoreUser:t,maxTimeoutUser:s,maxTimeoutValue:o,numbersSubmited:i,numbersFailed:a,timeoutedUsers:d,activeUsers:f,getMaxValueOf:g}=Xe(),x=[{name:"Numbers submitted",value:i},{name:"Numbers failed",value:a},{name:"Most timeouted user",value:g(d)},{name:"Most active user",value:g(f)},{name:"Max timeout",value:o},{name:"Max timeout by",value:s||"-"},{name:"Max score",value:e},{name:"Max score by",value:t||"-"}];return u.jsxs("div",{className:"flex flex-col gap-4",children:[u.jsx("h2",{className:"text-2xl text-white text-center",children:"Stats"}),u.jsx("table",{className:"w-full",children:u.jsx("tbody",{children:x.map(c=>u.jsxs("tr",{className:"border-b border-primary/30",children:[u.jsx("td",{className:"py-2 px-4 text-slate-400",children:c.name}),u.jsx("td",{className:"py-2 px-4 text-white text-right",children:c.value})]},c.name))})})]})}function ms(){const[e,t]=L.useState(!1),s=()=>t(o=>!o);return u.jsxs(u.Fragment,{children:[u.jsx("button",{className:"absolute bottom-0 left-0 border-2 border-primary p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-4lg outline-none",onClick:s,children:u.jsx(us,{})}),u.jsxs("div",{className:he("fixed bottom-0 right-0 bg-primary-dark w-screen h-screen z-20 transition-transform duration-200 flex justify-center items-center font-black",e?"translate-y-0 pointer-events-auto":"translate-y-full pointer-events-none"),children:[u.jsx("button",{className:"absolute top-2 right-2 border-2 border-primary text-primary p-2 rounded-lg",onClick:s,children:u.jsx(Qe,{})}),u.jsx(ds,{})]})]})}const Le=1e4,Ae=4,hs=1e3,fs=40,Re=Array.from({length:8},(e,t)=>new Audio(`/bubble-${t}.mp3`));function bs(){const{isAuthenticated:e}=Pe(),t=W(h=>h.channel),s=W(h=>h.volume),o=W(h=>h.enableTimeout),i=W(h=>h.timeoutBase),a=W(h=>h.timeoutMultiplier),d=W(h=>h.timeoutReason),f=W(h=>h.banMods),{status:g,number:x,user:c,maxScore:C,maxScoreUser:_,setGameState:y}=Ze(),{setStatsMaxScore:r,setStatsMaxTimeout:n,setStatsNumberSubmitedBy:l,setStatsTimeoutedUser:w}=Xe(),[b,m]=L.useState(null),[p]=is(),[E,{data:T}]=ls(),S=L.useRef(null),N=L.useRef({duration:Le,numberOfBubbles:Ae,volume:s});L.useEffect(()=>{e&&E({username:t})},[]),L.useEffect(()=>{const h=new URL(window.location.href),M=new URLSearchParams(h.hash.substr(1)),O=M.get("maxScore"),P=M.get("maxScoreUser"),z=Number(O),A=isFinite(z),Q=z%1===0,G=z>0;!O||!P||!A||!Q||!G||z<C||y(()=>({maxScore:z,maxScoreUser:P}))},[]),L.useEffect(()=>{if(!t)return;const h=new xt.Client({channels:[t]});return h.connect().catch(console.error),m(h),()=>{h.disconnect().catch(console.error)}},[t]);const k=L.useCallback((h,M,O,P)=>{if(P)return;const z=M["user-id"],A=M.displayName||M.username,Q=!!M.mod;if(!z||!A)return;const G=Number(O.replace(/[^\D\d]+$/,"").replace(/^[^\D\d]+/,"")),B=isFinite(G),Y=G%1===0,F=G>0;!B||!Y||!F||y(j=>{if(j.status===V.STARTED&&j.user===A)return{};if(!(G===j.number+1)){if(e&&o&&(a||i)&&T&&(f||!Q)&&j.number>0){const fe=i+j.number*a;w(A),n(fe,A),p({broadcasterId:T.id,moderatorId:T.id,userId:z,duration:fe,reason:d})}return{status:j.number===0?V.IDLE:V.GAME_OVER,number:0,user:A}}const ie=G>j.maxScore;return l(A),r(G,A),ie?{status:V.STARTED,number:j.number+1,user:A,maxScore:j.number+1,maxScoreUser:A}:{status:V.STARTED,number:j.number+1,user:A}})},[y,p,e,o,a,i,T]);return L.useEffect(()=>{if(b)return b.on("message",k),()=>{b.removeListener("message",k)}},[b,k]),L.useEffect(()=>{const h=Ne(0,x,50)/Ne(5,C,50);N.current={duration:Math.round(Me(Le,hs,h)),numberOfBubbles:Math.round(Me(Ae,fs,h)),volume:s}},[x,C,s]),L.useEffect(()=>{let h=null,M=0;const O=P=>{if(!S.current)return;const{duration:z,numberOfBubbles:A}=N.current;if(z/A<P-M){const B=Math.random()*Math.PI*2,Y=Math.sin(B)*25+50,F=Math.cos(B)*25+50,j=document.createElement("div");j.classList.add("absolute"),j.classList.add("bg-white"),j.classList.add("rounded-full"),j.classList.add("top-1/2"),j.classList.add("left-1/2"),j.classList.add("-translate-y-1/2"),j.classList.add("-translate-x-1/2"),j.classList.add("animate-bubble"),j.style.setProperty("--target-top",`${Y}%`),j.style.setProperty("--target-left",`${F}%`),j.style.setProperty("--animation-duration",`${z}ms`),S.current.appendChild(j),setTimeout(()=>{const{volume:R}=N.current;if(R>0){const ie=Re[Math.floor(Math.random()*Re.length)];ie.volume=R,ie.play()}},Math.floor(z*.67)),setTimeout(()=>{var R;(R=S.current)==null||R.removeChild(j)},z),M=P}h=requestAnimationFrame(O)};return h=requestAnimationFrame(O),()=>{h&&cancelAnimationFrame(h)}},[]),u.jsxs("div",{className:"relative group",children:[u.jsxs("div",{className:"relative flex items-center justify-center w-[400px] h-[400px] rounded-full",children:[[x-1,x].map(h=>h<0?null:u.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 w-[200px] h-[200px] flex justify-center items-center bg-black p-4 rounded-full overflow-hidden mix-blend-screen contrast-[100]",children:u.jsx("span",{className:he("text-8xl font-bold leading-tight text-white blur-[1px]",h===x?"animate-bubble-fade-in":"animate-bubble-fade-out opacity-0"),children:h})},h)),u.jsxs("div",{className:"absolute -inset-[50%]",children:[u.jsx("div",{className:"absolute inset-0 bg-primary-circle"}),u.jsx("div",{className:"absolute inset-0 bg-black blur-lg contrast-[100] flex items-center justify-center mix-blend-multiply",ref:S,children:u.jsx("div",{className:"bg-white w-[200px] h-[200px] rounded-full"})})]})]}),u.jsxs("p",{className:"text-xl font-bold text-white bg-primary py-2 px-6 rounded-3xl absolute top-0 left-1/2 -translate-x-1/2 whitespace-nowrap text-center",children:["Max Score: ",C,_&&u.jsxs(u.Fragment,{children:[u.jsx("br",{}),"by ",_]})]}),(g===V.GAME_OVER||g===V.STARTED)&&u.jsx("p",{className:"text-xl font-bold text-white bg-primary py-2 px-6 rounded-3xl absolute bottom-0 left-1/2 -translate-x-1/2 whitespace-nowrap text-center",children:g===V.GAME_OVER?`Blame on ${c}!`:c}),u.jsx(ms,{}),u.jsx(ts,{})]})}export{bs as default};
